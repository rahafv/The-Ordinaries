{% extends 'base_content.html' %}
{% load bootstrap_pagination %}
{% block title %}Chat{% endblock %}
{% block content %}

<script>
    $(document).ready(function(){
    
    setInterval(function(){
        $.ajax({
            type: 'GET',
            url : "/getMessages/{{club.id}}",
            success: function(response){
                console.log(response);
                $("#display").empty();
                for (var key in response.chats) {
                    var temp="<div class='container darker'><a>"+response.users[key]+"</a>"+response.chats[key].message+"<span class='time-left'>"+response.chats[key].created_at+"</span></div>";
                    $("#display").append(temp);
                }
            },
            error: function(response){
                //alert('An error occured')
            }
        });
    },1000);
    })
</script>

<h1 class="fw-light center mt-5" style="text-align:center;">Chat</h1>
<div id="display">    
</div>

<div>
    <form id="post-form">
        {% csrf_token %}
        <input type="hidden" name="username" id="username" value="{{user.username}}"/>
        <input type="hidden" name="club_id" id="club_id" value="{{club.id}}"/>
        <input type="text" name="message" id="message" width="100px" />
        <input type="submit" value="Send">
    </form>
</div>

<script type="text/javascript">
    $(document).on('submit','#post-form',function(e){
      e.preventDefault();
  
      $.ajax({
        type:'POST',
        url:'/send',
        data:{
            username:$('#username').val(),
            club_id:$('#club_id').val(),
            message:$('#message').val(),
          csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data){
           // alert(data)
        }
      });
      document.getElementById('message').value = ''
    });
  </script>

{% endblock %}
